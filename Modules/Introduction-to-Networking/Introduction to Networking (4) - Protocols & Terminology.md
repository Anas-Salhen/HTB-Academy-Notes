# Networking Key Terminology
| **Protocol**                                      | **Acronym** | **Description**                                                                                                                                                                                                                                                                                |
| ------------------------------------------------- | ----------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Wired Equivalent Privacy                          | `WEP`       | WEP is a type of security protocol that was commonly used to secure wireless networks.                                                                                                                                                                                                         |
| Secure Shell                                      | `SSH`       | A secure network protocol used to log into and execute commands on a remote system                                                                                                                                                                                                             |
| File Transfer Protocol                            | `FTP`       | A network protocol used to transfer files from one system to another                                                                                                                                                                                                                           |
| Simple Mail Transfer Protocol                     | `SMTP`      | A protocol used to send and receive emails                                                                                                                                                                                                                                                     |
| Hypertext Transfer Protocol                       | `HTTP`      | A client-server protocol used to send and receive data over the internet                                                                                                                                                                                                                       |
| Server Message Block                              | `SMB`       | A protocol used to share files, printers, and other resources in a network                                                                                                                                                                                                                     |
| Network File System                               | `NFS`       | A protocol used to access files over a network                                                                                                                                                                                                                                                 |
| Simple Network Management Protocol                | `SNMP`      | A protocol used to manage network devices                                                                                                                                                                                                                                                      |
| Wi-Fi Protected Access                            | `WPA`       | WPA is a wireless security protocol that uses a password to protect wireless networks from unauthorized access.                                                                                                                                                                                |
| Temporal Key Integrity Protocol                   | `TKIP`      | TKIP is also a security protocol used in wireless networks but less secure.                                                                                                                                                                                                                    |
| Network Time Protocol                             | `NTP`       | It is used to synchronize the timing of computers on a network.                                                                                                                                                                                                                                |
| Virtual Local Area Network                        | `VLAN`      | It is a way to segment a network into multiple logical networks.                                                                                                                                                                                                                               |
| VLAN Trunking Protocol                            | `VTP`       | VTP is a Layer 2 protocol that is used to establish and maintain a virtual LAN (VLAN) spanning multiple switches.                                                                                                                                                                              |
| Routing Information Protocol                      | `RIP`       | RIP is a distance-vector routing protocol used in local area networks (LANs) and wide area networks (WANs).                                                                                                                                                                                    |
| Open Shortest Path First                          | `OSPF`      | It is an interior gateway protocol (IGP) for routing traffic within a single Autonomous System (AS) in an Internet Protocol (IP) network.                                                                                                                                                      |
| Interior Gateway Routing Protocol                 | `IGRP`      | IGRP is a Cisco proprietary interior gateway protocol designed for routing within autonomous systems.                                                                                                                                                                                          |
| Enhanced Interior Gateway Routing Protocol        | `EIGRP`     | It is an advanced distance-vector routing protocol that is used to route IP traffic within a network.                                                                                                                                                                                          |
| Pretty Good Privacy                               | `PGP`       | PGP is an encryption program that is used to secure emails, files, and other types of data.                                                                                                                                                                                                    |
| Network News Transfer Protocol                    | `NNTP`      | NNTP is a protocol used for distributing and retrieving messages in newsgroups across the internet.                                                                                                                                                                                            |
| Cisco Discovery Protocol                          | `CDP`       | It is a proprietary protocol developed by Cisco Systems that allows network administrators to discover and manage Cisco devices connected to the network.                                                                                                                                      |
| Hot Standby Router Protocol                       | `HSRP`      | HSRP is a protocol used in Cisco routers to provide redundancy in the event of a router or other network device failure.                                                                                                                                                                       |
| Virtual Router Redundancy Protocol                | `VRRP`      | It is a protocol used to provide automatic assignment of available Internet Protocol (IP) routers to participating hosts.                                                                                                                                                                      |
| Spanning Tree Protocol                            | `STP`       | STP is a network protocol used to ensure a loop-free topology in Layer 2 Ethernet networks.                                                                                                                                                                                                    |
| Terminal Access Controller Access-Control System+ | `TACACS+`   | TACACS+ is a protocol that provides centralized authentication, authorization, and accounting for network access.                                                                                                                                                                              |
| Session Initiation Protocol                       | `SIP`       | It is a signaling protocol used for establishing and terminating real-time voice, video and multimedia sessions over an IP network.                                                                                                                                                            |
| Voice Over IP                                     | `VOIP`      | VOIP is a technology that allows for telephone calls to be made over the internet.                                                                                                                                                                                                             |
| Extensible Authentication Protocol                | `EAP`       | EAP is a framework for authentication that supports multiple authentication methods, such as passwords, digital certificates, one-time passwords, and public-key authentication.                                                                                                               |
| Lightweight Extensible Authentication Protocol    | `LEAP`      | LEAP is a proprietary wireless authentication protocol developed by Cisco Systems. It is based on the Extensible Authentication Protocol (EAP) used in the Point-to-Point Protocol (PPP).                                                                                                      |
| Protected Extensible Authentication Protocol      | `PEAP`      | PEAP is a security protocol that provides an encrypted tunnel for wireless networks and other types of networks.                                                                                                                                                                               |
| Systems Management Server                         | `SMS`       | SMS is a systems management solution that helps organizations manage their networks, systems, and mobile devices.                                                                                                                                                                              |
| Microsoft Baseline Security Analyzer              | `MBSA`      | It is a free security tool from Microsoft that is used to detect potential security vulnerabilities in Windows computers, networks, and systems.                                                                                                                                               |
| Supervisory Control and Data Acquisition          | `SCADA`     | It is a type of industrial control system that is used to monitor and control industrial processes, such as those in manufacturing, power generation, and water and waste treatment.                                                                                                           |
| Virtual Private Network                           | `VPN`       | VPN is a technology that allows users to create a secure, encrypted connection to another network over the internet.                                                                                                                                                                           |
| Internet Protocol Security                        | `IPsec`     | IPsec is a protocol used to provide secure, encrypted communication over a network. It is commonly used in VPNs, or Virtual Private Networks, to create a secure tunnel between two devices.                                                                                                   |
| Point-to-Point Tunneling Protocol                 | `PPTP`      | It is a protocol used to create a secure, encrypted tunnel for remote access.                                                                                                                                                                                                                  |
| Network Address Translation                       | `NAT`       | NAT is a technology that allows multiple devices on a private network to connect to the internet using a single public IP address. NAT works by translating the private IP addresses of devices on the network into a single public IP address, which is then used to connect to the internet. |
| Carriage Return Line Feed                         | `CRLF`      | Combines two control characters to indicate the end of a line and a start of a new one for certain text file formats.                                                                                                                                                                          |
| Asynchronous JavaScript and XML                   | `AJAX`      | Web development technique that allows creating dynamic web pages using JavaScript and XML/JSON.                                                                                                                                                                                                |
| Internet Server Application Programming Interface | `ISAPI`     | Allows to create performance-oriented web extensions for web servers using a set of APIs.                                                                                                                                                                                                      |
| Uniform Resource Identifier                       | `URI`       | It is a syntax used to identify a resource on the Internet.                                                                                                                                                                                                                                    |
| Uniform Resource Locator                          | `URL`       | Subset of URI that identifies a web page or another resource on the Internet, including the protocol and the domain name.                                                                                                                                                                      |
| Internet Key Exchange                             | `IKE`       | IKE is a protocol used to set up a secure connection between two computers. It is used in virtual private networks (VPNs) to provide authentication and encryption for data transmission, protecting the data from outside eavesdropping and tampering.                                        |
| Generic Routing Encapsulation                     | `GRE`       | This protocol is used to encapsulate the data being transmitted within the VPN tunnel.                                                                                                                                                                                                         |
| Remote Shell                                      | `RSH`       | It is a program under Unix that allows executing commands and programs on a remote computer.                                                                                                                                                                                                   |

# Common Protocols
## TCP
Transmission Control Protocol (TCP) is a connection-oriented protocol that establishes a connection between two devices using a three-way-handshake and the connection is maintained until all data transfer is complete. Some protocols that rely on TCP are:

| **Protocol**                             | **Acronym**  | **Port**         | **Description**                                                                                                                                                                    |
| ---------------------------------------- | ------------ | ---------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| File Transfer Protocol                   | `FTP`        | `20-21`          | Used to transfer files                                                                                                                                                             |
| Secure Shell                             | `SSH`        | `22`             | Secure remote login service                                                                                                                                                        |
| Secure Copy Protocol                     | `SCP`        | `22`             | Securely copy files between systems                                                                                                                                                |
| Telnet                                   | `Telnet`     | `23`             | Remote login service                                                                                                                                                               |
| Simple Mail Transfer Protocol            | `SMTP`       | `25`             | Used for email transfer                                                                                                                                                            |
| Domain Name System                       | `DNS`        | `53`             | Lookup domain names                                                                                                                                                                |
| Hyper Text Transfer Protocol             | `HTTP`       | `80`             | Used to transfer webpages                                                                                                                                                          |
| Simple Object Access Protocol            | `SOAP`       | `80`, `443`      | Used for web services                                                                                                                                                              |
| Kerberos                                 | `Kerberos`   | `88`             | Used for authentication and authorization                                                                                                                                          |
| Post Office Protocol                     | `POP3`       | `110`            | Used to retrieve emails                                                                                                                                                            |
| Network File System                      | `NFS`        | `111`, `2049`    | Used to mount remote systems                                                                                                                                                       |
| Identification Protocol                  | `Ident`      | `113`            | Used to identify user processes                                                                                                                                                    |
| Network News Transfer Protocol           | `NNTP`       | `119`            | Used to access newsgroups                                                                                                                                                          |
| Network Time Protocol                    | `NTP`        | `123`            | Synchronize computer clocks                                                                                                                                                        |
| Remote Procedure Call                    | `RPC`        | `135`, `137-139` | Used to call remote procedures                                                                                                                                                     |
| Internet Message Access Protocol         | `IMAP`       | `143`            | Used to access emails                                                                                                                                                              |
| Simple Network Management Protocol       | `SNMP`       | `161-162`        | Manage network devices                                                                                                                                                             |
| Lightweight Directory Access Protocol    | `LDAP`       | `389`            | Used for directory services                                                                                                                                                        |
| Hyper Text Transfer Protocol Secure      | `HTTPS`      | `443`            | Used to transfer secure webpages                                                                                                                                                   |
| Secure Socket Layer                      | `SSL`        | `443`            | Securely transfer files                                                                                                                                                            |
| Server Message Block                     | `SMB`        | `445`            | Used to transfer files                                                                                                                                                             |
| Remote Execution                         | `REXEC`      | `512`            | This protocol is used to execute commands on remote computers and send the output of commands back to the local computer.                                                          |
| Remote Login                             | `RLOGIN`     | `513`            | This protocol starts an interactive shell session on a remote computer.                                                                                                            |
| Kerberized Internet Negotiation of Keys  | `KINK`       | `910`            | Used for authentication and authorization                                                                                                                                          |
| Microsoft SQL Server                     | `ms-sql-s`   | `1433`           | Used for client connections to the Microsoft SQL Server.                                                                                                                           |
| Oracle DB (Default/Alternative) Listener | `oracle-tns` | `1521`/`1526`    | The Oracle database default/alternative listener is a service that runs on the database host and receives requests from Oracle clients.                                            |
| Ingres Lock                              | `ingreslock` | `1524`           | Ingres database is commonly used for large commercial applications and as a backdoor that can execute commands remotely via RPC.                                                   |
| Point-to-Point Tunneling Protocol        | `PPTP`       | `1723`           | Is used to create VPNs                                                                                                                                                             |
| Squid Web Proxy                          | `http-proxy` | `3128`           | Squid web proxy is a caching and forwarding HTTP web proxy used to speed up a web server by caching repeated requests.                                                             |
| Remote Desktop Protocol                  | `RDP`        | `3389`           | Used for remote desktop access                                                                                                                                                     |
| Session Initiation Protocol              | `SIP`        | `5060`           | Used for VoIP sessions                                                                                                                                                             |
| TCP Wrappers                             | `TCPW`       | -                | Used for access control                                                                                                                                                            |
| X Window System                          | `X11`        | `6000`           | It is a computer software system and network protocol that provides a graphical user interface (GUI) for networked computers.                                                      |
| Relational Database Management System    | `DB2`        | `50000`          | RDBMS is designed to store, retrieve and manage data in a structured format for enterprise applications such as financial systems, customer relationship management (CRM) systems. |

## UDP
User Datagram Protocol is a connectionless protocol which means that it doesn't establish a connection and just sends data. This means that it doesn't check if the data is actually received but it's also more lightweight than TCP. UDP is used in scenarios where transmission speed is more important than losing a few packets like voice calls for example. Below are some protocols that utilize UDP, you might notice that some use both TCP and UDP.

| **Protocol**                                              | **Acronym**  | **Port**       | **Description**                                                                                                                                    |
| --------------------------------------------------------- | ------------ | -------------- | -------------------------------------------------------------------------------------------------------------------------------------------------- |
| Domain Name System                                        | `DNS`        | `53`           | It is a protocol to resolve domain names to IP addresses.                                                                                          |
| Dynamic Host Configuration Protocol                       | `DHCP`       | `67`           | It is used to assign IP addresses to devices in a network dynamically.                                                                             |
| Bootstrap Protocol                                        | `BOOTP`      | `68`           | It is used to bootstrap hosts in a network.                                                                                                        |
| Trivial File Transfer Protocol                            | `TFTP`       | `69`           | It is used to transfer files between systems.                                                                                                      |
| Network Time Protocol                                     | `NTP`        | `123`          | It synchronizes computer clocks in a network.                                                                                                      |
| NetBIOS Name                                              | `netbios-ns` | `137`          | It is used in Windows operating systems to resolve NetBIOS names to IP addresses on a LAN.                                                         |
| Simple Network Management Protocol                        | `SNMP`       | `161`          | It monitors and manages network devices remotely.                                                                                                  |
| X Display Manager Control Protocol                        | `XDMCP`      | `177`          | XDMCP is a network protocol that allows a user to remotely log in to a computer running the X11.                                                   |
| Internet Relay Chat                                       | `IRC`        | `194`          | It is a real-time Internet text messaging (chat) or synchronous communication protocol.                                                            |
| Internet Protocol Security                                | `IPsec`      | `500`          | IPsec is also a protocol that provides secure, encrypted communication. It is commonly used in VPNs to create a secure tunnel between two devices. |
| Internet Key Exchange                                     | `IKE`        | `500`          | Internet Key Exchange                                                                                                                              |
| Internet Security Association and Key Management Protocol | `ISAKMP`     | `500`          | Used for VPN connections                                                                                                                           |
| Syslog                                                    | `SYSLOG`     | `514`          | It is a standard protocol to collect and store log messages on a computer system.                                                                  |
| Routing Information Protocol                              | `RIP`        | `520`          | It is used to exchange routing information between routers.                                                                                        |
| Microsoft SQL Server                                      | `ms-sql-m`   | `1434`         | Used for the Microsoft SQL Server Browser service.                                                                                                 |
| Remote Authentication Dial-In User Service                | `RADIUS`     | `1812`, `1813` | Used for authentication and authorization                                                                                                          |
| Universal Plug and Play                                   | `UPnP`       | `1900`         | It is a protocol for devices to discover each other on the network and communicate.                                                                |
| MySQL                                                     | `MySQL`      | `3306`         | It is an open-source database management system.                                                                                                   |
| Terminal Server                                           | `TS`         | `3389`         | It is a remote access protocol used for Microsoft Windows Terminal Services by default.                                                            |
| PostgreSQL                                                | `PGSQL`      | `5432`         | It is an object-relational database management system.                                                                                             |
| Virtual Network Computing                                 | `VNC`        | `5900`         | It is a graphical desktop sharing system.                                                                                                          |
| X Window System                                           | `X11`        | `6000-6063`    | It is a computer software system and network protocol that provides GUI on Unix-like systems.                                                      |
| OpenPGP                                                   | `OpenPGP`    | `11371`        | It is a protocol for encrypting and signing data and communications.                                                                               |


## Additional Protocols
| **Protocol**                       | **Acronym** | **Description**                     |
| ---------------------------------- | ----------- | ----------------------------------- |
| Open Shortest Path First           | `OSPF`      | Used for routing                    |
| Internet Control Message Protocol  | `ICMP`      | Used to troubleshoot network issues |
| Internet Group Management Protocol | `IGMP`      | Used for multicasting               |

## ICMP
Internet Control Message Protocol (ICMP), one of its famous uses are pings. For IPv4 there is ICMPv4 and for IPv6 there is ICMPv6 Examples of ICMP messages:

| **Request Type**       | **Description**                                                                                                                                                                                                                                       |
| ---------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `Echo Request`         | This message tests whether a device is reachable on the network. When a device sends an echo request, it expects to receive an echo reply message. For example, the tools `tracert` (Windows) or `traceroute` (Linux) always send ICMP echo requests. |
| `Timestamp Request`    | This message determines the time on a remote device.                                                                                                                                                                                                  |
| `Address Mask Request` | This message is used to request the subnet mask of a device.                                                                                                                                                                                          |

| **Message Type**          | **Description**                                                                                                                  |
| ------------------------- | -------------------------------------------------------------------------------------------------------------------------------- |
| `Echo reply`              | This message is sent in response to an echo request message.                                                                     |
| `Destination unreachable` | This message is sent when a device cannot deliver a packet to its destination.                                                   |
| `Redirect`                | A router sends this message to inform a device that it should send its packets to a different router.                            |
| `time exceeded`           | This message is sent when a packet has taken too long to reach its destination.                                                  |
| `Parameter problem`       | This message is sent when there is a problem with a packet's header.                                                             |
| `Source quench`           | This message is sent when a device receives packets too quickly and cannot keep up. It is used to slow down the flow of packets. |

## TTL
Time-To-Live is a field in the packet header which limits the lifetime of the packet and prevents it from wandering indefinitely in the network. Each time the packet passes through the router its TTL gets decremented by 1 until it reaches 0. When that happens the router sends an ICMP time exceeded message to the sender.

We can use TTL to know how many hops the packet took to reach us and approximate the destination. Also, it can help us determine the OS of the sender. Windows (`2000/XP/2003/Vista/10`) typically send packets with a TTL value of 128, macOS and Linux use a TTL value of 64 and Solaris uses 255.

## VoIP
Voice over Internet Protocol (VoIP) is a method to transmit voice and multimedia communications over the internet like Skype, WhatsApp, Google Meet, Slack, Zoom, and others.

Most common ports used by VoIP are TCP/5060 and TCP/5061 which are used for Session Initiation Protocol (SIP), some VoIP systems use TCP/1720 for the H.323 protocol however SIP is more widely used. Some methods used by SIP are:

| **Method** | **Description**                                                                                                    |
| ---------- | ------------------------------------------------------------------------------------------------------------------ |
| `INVITE`   | Initiates a session or invites another endpoint to participate.                                                    |
| `ACK`      | Confirms the receipt of an INVITE request.                                                                         |
| `BYE`      | Terminate a session.                                                                                               |
| `CANCEL`   | Cancels a pending INVITE request.                                                                                  |
| `REGISTER` | Registers a SIP user agent (UA) with a SIP server.                                                                 |
| `OPTIONS`  | Requests information about the capabilities of a SIP server or user agent, such as the types of media it supports. |

# Wireless Networks
They use radio frequency (RF) to transmit data between devices. Each device has a network device that converts data into RF and vice versa. Many technologies are used depending on the range needed. A LAN that covers a small area uses Wi-Fi which has a range of a few hundred feet. A Wireless Wide Area Network (WWAN) uses cellular data technologies like 3G, 4G LTE, 5G which can cover an entire city or region.

In Wi-Fi RF bands 2.4 GHz and 5 GHz are used. When a device wants to access the network it first requests permission from the Wireless Access Point (a router).

## Wi-Fi Connection
When a device wants to join the network it sends to the WAP a connection request frame or association request and is sent using the IEEE 802.11 wireless networking protocol. This request contains fields like:
- MAC address: A unique identifier for the device's wireless adapter.
- SSID: The network name, also known as the Service Set Identifier of the Wi-Fi network.
- Supported data rates: A list of the data rates the device can communicate.
- Supported channels: A list of the `channels` (frequencies) on which the device can communicate.
- Supported security protocols: A list of the security protocols that the device is capable of using, such as `WPA2`/`WPA3`.
The SSID of the network can be hidden by disabling broadcasting.

## WEP Challenge-Response Handshake
It is a process to establish a secure connection between a WAP and a device that uses the WEP security protocol.

| **Step** | **Who**  | **Description**                                                                                                                              |
| -------- | -------- | -------------------------------------------------------------------------------------------------------------------------------------------- |
| 1        | `Client` | Sends an association request packet to the WAP, requesting access.                                                                           |
| 2        | `WAP`    | Responds with an association response packet to the client, which includes a challenge string.                                               |
| 3        | `Client` | Calculates a response to the challenge string and a shared secret key and sends it back to the WAP.                                          |
| 4        | `WAP`    | Calculates the expected response to the challenge with the same shared secret key and sends an authentication response packet to the client. |
The WEP protocol has a mechanism called Cyclic Redundancy Check (CRC) that protects against data corruption in case some packets get lost. A CRC value is calculated for each packet depending on its data. When the packet reaches the destination the device calculates a CRC value based on the data of the packet. If it matches the original CRC value then no problems occurred in transmission.

There is a flaw in CRC that allows us to decrypt the packet without knowing the encryption key. The CRC value is calculated based on the plaintext data before being encrypted. Therefore if we get the CRC value we can know the data of the packet without needing an encryption key.

## Security Features
- Encryption: The most common encryption algorithms in WiFi networks are [Wired Equivalent Privacy](https://en.wikipedia.org/wiki/Wired_Equivalent_Privacy) (`WEP`), [WiFi Protected Access 2](https://en.wikipedia.org/wiki/Wi-Fi_Protected_Access#WPA2) (`WPA2`), and [WiFi Protected Access 3](https://en.wikipedia.org/wiki/Wi-Fi_Protected_Access#WPA3) (`WPA3`).
- Access Control
- Firewalls

## Encryption Protocols
### WEP
Wired Equivalent Privacy (WEP) uses a 40-bit or 104-bit key to encrypt data, while WPA using AES uses a 128-bit key, longer keys are more secure. WEP is not compatible with newer devices and operating systems and is generally no longer considered secure. Also, it uses the RC4 cipher encryption algorithm (vulnerable to attacks) and uses the same key for encryption and authentication.

The encryption key is formed using a secret key and an Initialization Vector (IV). Here are the 2 types of WEP:

| **Protocol**                | **IV** | **Secret Key** |
| --------------------------- | ------ | -------------- |
| WEP-40 also called WEP-64   | 24-bit | 40-bit         |
| WEP-104 also called WEP-128 | 24-bit | 104-bit        |
The problem is the IV is too small and can actually be brute forced.

### WPA
WiFi Protected Access (WPA) provides a higher level of security than WEP. It also uses more secure authentication methods like Pre-Shared Key (PSK) or an 802.1X authentication server. Wireless networks especially in critical infrastructure should implement at least WPA2 or WPA3.

## Authentication Protocols
[Lightweight Extensible Authentication Protocol](https://en.wikipedia.org/wiki/Lightweight_Extensible_Authentication_Protocol) (`LEAP`) and [Protected Extensible Authentication Protocol](https://en.wikipedia.org/wiki/Protected_Extensible_Authentication_Protocol) (`PEAP`) are widely used authentication protocols and are often used in conjunction with WEP or WPA. They are both based on the [Extensible Authentication Protocol](https://en.wikipedia.org/wiki/Extensible_Authentication_Protocol) (`EAP`) however one key difference between them is how they secure the authentication process.
- LEAP uses a shared key for authentication, which means that the same key is used for encryption and authentication. So the network can be accessed easily if the key is compromised.
- PEAP uses a more secure method called Transport Layer Security (TLS) which connects the device and the WAP using a digital certificate, and an encrypted tunnel protects the authentication process.

## TACACS+
TACACS+ is a proprietary Cisco protocol (now an open standard) used primarily to authenticate and authorize users accessing network devices. It encrypts the entire body of its packets using a shared secret key and MD5 hashing, not SSL/TLS or IPsec. The specific encryption method is fixed by the protocol and is not negotiable based on device capabilities.

## Disassociation Attack
A [Disassociation Attack](https://www.makeuseof.com/what-are-disassociation-attacks/) is an attack that disrupts the communication between a WAP and its clients by sending disassociation frames that disconnect the client from the network.

This attack can cause inconvenience to users but can also be more dangerous. By forcing users to reconnect to the network they can be exposed to more attack like MITM.

## Wireless Hardening
-  Disabling broadcasting: this hides the network from devices that aren't connected to it.
- WPA: it provides strong security features. There are 2 versions WPA-Personal for homes and small networks and WPA-Enterprise for larger organizations which uses a centralized authentication server (e.g., RADIUS or TACACS+).
- MAC filtering: it allows or rejects devices based on their MAC address
- Deploying EAP-TLS: EAP-TLS is a security protocol used to authenticate and encrypt wireless communications. It uses digital certificates and PKI to verify the identity of clients.

# Virtual Private Networks
VPNs typically use the ports TCP/1723 for PPTP VPN connections and UDP/500 for IKEv1 and IKEv2 VPN connections. Requirements for a VPN to work:

| **Requirement**  | **Description**                                                                                                                                                         |
| ---------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `VPN Client`     | This is installed on the remote device and is used to establish and maintain a VPN connection with the VPN server. For example, this could be an OpenVPN client.        |
| `VPN Server`     | This is a computer or network device responsible for accepting VPN connections from VPN clients and routing traffic between the VPN clients and the private network.    |
| `Encryption`     | VPN connections are encrypted using a variety of encryption algorithms and protocols, such as AES and IPsec, to secure the connection and protect the transmitted data. |
| `Authentication` | The VPN server and client must authenticate each other using a shared secret, certificate, or another authentication method to establish a secure connection.           |

## IPSec
Internet Protocol Security (IPSec) provides security and authentication for internet connections. It works by encrypting the data payload of each IP packet and adding an Authentication Header (AH) used to verify the integrity and authenticity of the packet. IPSec uses a combination of two protocols:
1. Authentication Header (AH): this protocol provides integrity and authenticity for IP packets but does not provide encryption.
2. Encapsulating Security Payload (ESP): this protocol provides encryption and optional authentication.

IPSec can be used in 2 modes:
- Transport Mode: IPsec encrypts and authenticates the data payload of each IP packet but does not encrypt the IP header. This is typically used to secure end-to-end communication between two hosts.
- Tunnel Mode: IPsec encrypts and authenticates the entire IP packet, including the IP header. This is typically used to create a VPN tunnel between two networks.

In case of a firewall, several protocols need to be allowed for the IPSec VPN to function properly.

|**Protocol**|**Port**|**Description**|
|---|---|---|
|`Internet Protocol` (`IP`)|`UDP/50-51`|This is the primary protocol that provides the foundation for all internet communication. It is used to route packets of data between the VPN client and the VPN server.|
|`Internet Key Exchange` (`IKE`)|`UDP/500`|IKE is a protocol that is used to establish and maintain secure communication between the VPN client and the VPN server. It is based on the Diffie-Hellman key exchange algorithm, and it is used to negotiate and establish shared secret keys that can be used to encrypt and decrypt the VPN traffic.|
|`Encapsulating Security Payload` (`ESP`)|`UDP/4500`|ESP is also a protocol that provides encryption and authentication for IP datagrams. It is used to encrypt the VPN traffic between the VPN client and the VPN server, using the keys that were negotiated with IKE.|

## PPTP
Point-to-Point Tunneling Protocol is a protocol that creates a secure tunnel between the VPN server and the client and is originally an extension of the Point-to-Point (PPP) protocol.

It can tunnel protocols such as IP, IPX, or NetBEUI via IP, but has been largely replaced by more secure VPN protocols like L2TP/IPsec, IPsec/IKEv2, and OpenVPN. Since 2012, the use of PPTP has declined because its authentication method, MSCHAPv2, employs the outdated DES encryption, which can be easily cracked with specialized hardware.

# Vendor Specific Information
Cisco IOS is the OS used in Cisco's network devices. It can be managed using the CLI or GUI and it supports many protocols including:

| **Protocol Type**     | **Description**                                                                                                                                                                                                                                  |
| --------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `Routing protocols`   | Such as [OSPF](https://en.wikipedia.org/wiki/Open_Shortest_Path_First) and [BGP](https://en.wikipedia.org/wiki/Border_Gateway_Protocol) are used to route data packets on a network.                                                             |
| `Switching protocols` | Such as [VLAN Trunking Protocol](https://en.wikipedia.org/wiki/VLAN_Trunking_Protocol) (`VTP`) and [Spanning Tree Protocol](https://en.wikipedia.org/wiki/Spanning_Tree_Protocol) (`STP`) is used to configure and manage switches on a network. |
| `Network services`    | Such as [Dynamic Host Configuration Protocol](https://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol) (`DHCP`) are used to automatically provide clients on the network with IP addresses and other network configurations.           |
| `Security features`   | Such as [Access Control Lists](https://en.wikipedia.org/wiki/Access-control_list) (`ACLs`), which are used to control access to network resources and prevent security threats.                                                                  |
There are also different types of passwords:

| **Password Type** | **Description**                                                                                                                                                                                                                                                       |
| ----------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `User`            | The [user](https://www.cisco.com/c/en/us/td/docs/ios-xml/ios/security/s1/sec-s1-cr-book/sec-cr-t2.html#wp2992613898) password is used for logging in to Cisco IOS. It is used to restrict access to the network device and its features.                              |
| `Enable Password` | The [enable password](https://www.cisco.com/c/en/us/td/docs/ios-xml/ios/security/d1/sec-d1-cr-book/sec-cr-e1.html#wp3884449514) is used to enter "enable" mode. The "enable" mode is the mode where you have access to advanced functions and settings.               |
| `Secret`          | The [secret](https://www.cisco.com/c/en/us/td/docs/ios-xml/ios/security/s1/sec-s1-cr-book/sec-cr-s1.html#wp2622423174) is a password to secure access to certain functions and services. It is often used to restrict access to remote management tools and services. |
| `Enable Secret`   | The [enable secret](https://www.cisco.com/c/en/us/td/docs/ios-xml/ios/security/d1/sec-d1-cr-book/sec-cr-e1.html#wp3438133060) is an extra-secure password used to secure access to "enable" mode, and they are stored encrypted to provide additional protection.     |
Cisco devices can also be managed with SSH and Telnet. When we connect to them they respond with a user access verification message.
```shell-session
AnasSalhen@htb[/htb]$ telnet 10.129.10.2

Trying 10.129.10.2...
Connected to 10.129.10.2.
Escape character is '^]'.


User Access Verification

Password:
```

## VLANs
A Local Area Network (LAN) is a small network in which all devices are within the same broadcast domain. But what if a company has people within that LAN from different departments? Having them on the same broadcast domain (when a message is broadcasted it reaches all of them) isn't the best from a security perspective. Insider attacks that abuse this like broadcast storms can happen.

To prevent that we need to split that LAN into smaller broadcast domains each one of them is called a Virtual LAN (VLAN). That VLAN can also span multiple LANs in case we have people from the same department but in different offices that use different LANs. Also, each VLAN needs its own subnet.

Benefits of using VLANs:
- Better Organization: Network administrators can group endpoints based on any common attribute they share.
- Increased Security: Network segmentation disallows unauthorized members from sniffing network packets in other VLANs.
- Simplified Administration: Network administrators do not have to worry about the physical locations of an endpoint.
- Increased Performance: With reduced broadcast traffic for all endpoints, more bandwidth is made available for use by the network.

Cisco switches provide the VLAN IDs/numbers 1-4094 (0 and 4095 are reserved). From VLAN 1 (VLAN 1 is known as the default VLAN and can't/shouldn't be altered nor deleted) to VLAN 1005  are known as normal-range VLANs. IDs 1002-1005 being reserved for Token Ring and Fiber Distributed Data Interface (FDDI) VLANs, while IDs 1006-4094 are known as extended-range VLANs.

By default, any customization applied for normal-range VLANs is saved in the VLAN database (the `vlan.dat` file), in contrast to extended-range VLANs, which do not have their customizations saved. VLANs 2-1001 stored in `vlan.dat` can have parameters including name, type, state, and maximum transmission unit (`MTU`).

## VLAN Memberships
Interfaces can be assigned to VLANs both in a static and a dynamic method. Static VLANs are assigned manually by an admin while dynamic VLANs are assigned automatically based on certain protocols and they use and they use services like VLAN Membership Policy Server (VMPS) to determine who is a member of this VLAN based on their MAC address.

Static VLANs are considered more secure since with dynamic VLANs attackers could use tools like [macchanger](https://github.com/alobbs/macchanger) to spoof the MAC address of legitimate endpoints and access the VLAN.

## Access and Trunk Ports
Any interface on a VLAN enabled device is either an access or trunk port. Access ports belong to only one VLAN (or 2 in the case of voice traffic) and traffic arriving at that port is assumed to belong to that VLAN. Trunk ports on the other hand can join multiple VLANs at the same time.

## VLAN Identification
Standard 802.3 Ethernet frames do not contain VLAN information. To solve this problem we can use one of these 2 protocols ISL or IEEE 802.1Q.

### ISL
Inter-Switch Link (ISL) is a Cisco-proprietary protocol used for trunking between VLAN-enabled devices. ISL encapsulated the entire Ethernet frame, including the original Ethernet header and the VLAN tag, adding its 26-byte header and 4-byte trailer. Nowadays it is deprecated in most devices (including Cisco's) in favor of the newer 802.1Q protocol.

### IEEE 802.1Q
Developed in 1998, the IEEE 802 committee had to change the 802.3 Ethernet frame by adding a pair of 2-byte fields: TPID and TCI (consists of the subfields PCP, DEI and VID) resulting in a VLAN-compliant 802.1Q Ethernet frame.  
<img width="1872" height="1188" alt="Pasted image 20250827033010" src="https://github.com/user-attachments/assets/8718b03b-6a4d-4058-84d9-b39410ae37d2" />
  
Tag Protocol Identifier (TPID) is a 16-bit field always set to 0x8100 which identifies the frame as an 802.1Q tagged frame. Tag Control Information (TCI) contains PCP, DEI and VID. The main field concerning VLANs is VLAN ID (VID). Since it has 12 bits it can represent 2^12 = 4096 VLAN IDs.

VLAN tagging into an 802.1Q header while VLAN untagging is removing the VLAN info from the frame and forwarding it to the destined ports. There is also double tagging which is inserting multiple 802.1Q tags within a single packet.

## VLAN Capable NICs
### Linux
First we need to load the module for 802.1Q:
```shell-session
AnasSalhen@htb[/htb]$ sudo modprobe 8021q
```
Check if it loaded successfully:
```shell-session
AnasSalhen@htb[/htb]$ lsmod | grep 8021

8021q                  40960  0
garp                   16384  1 8021q
mrp                    20480  1 8021q
```
We need to create a child interface of an already existing parent interface. Before that let's see the interface we will use as the parent:
```shell-session
AnasSalhen@htb[/htb]$ ip a

<SNIP>
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether a6:ba:3b:08:3a:36 brd ff:ff:ff:ff:ff:ff
    altname enp0s3
    altname ens3
    inet 94.2X.5X.72/22 brd 94.237.51.255 scope global dynamic eth0
       valid_lft 83489sec preferred_lft 83489sec
    inet6 fe80::a4ba:3bff:fe08:3a36/64 scope link 
       valid_lft forever preferred_lft forever
```
Create the interface for the VLAN (i.e. VLAN 20) on top of `eth0` using `vconfig` (deprecated):
```shell-session
sudo vconfig add eth0 20
```
Or using `ip`:
```shell-session
sudo ip link add link eth0 name eth0.20 type vlan id 20
```
Either of these commands will make the `eth0.20@eth0` interface. Then we assign it an IP address and start it:
```shell-session
AnasSalhen@htb[/htb]$ sudo ip addr add 192.168.1.1/24 dev eth0.20
AnasSalhen@htb[/htb]$ sudo ip link set up eth0.20
```
Check if it's working properly:
```shell-session
AnasSalhen@htb[/htb]$ ip a | grep eth0.20

4: eth0.20@eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000
    inet 192.168.1.1/24 scope global eth0.20
```

### Windows
Open Device Manager, click on properties for the Ethernet interface we want to assign to a VLAN:  
<img width="2970" height="1672" alt="Pasted image 20250827163558" src="https://github.com/user-attachments/assets/62f0a553-6310-4279-827e-c6bcae42fa11" />  
Within Advanced, there will be a VLAN ID property to which we can assign a value.  
<img width="2918" height="1646" alt="Pasted image 20250827163717" src="https://github.com/user-attachments/assets/7f56d19b-4feb-44fd-9a1b-e4c3a430552b" />  

We can also use PS instead of the GUI. Use `Get-NetAdapter` to view available network adapters. If we want to get the VLAN ID of an interface (like `Ethernet 2`) use: `Get-NetAdapterAdvancedProperty -DisplayName "vlan id"`. To change it use: `Set-NetAdapter -Name "Ethernet 2" -VlanID 10`. The command `Set-NetAdapter` can be used to change other things like MAC addresses.

## Analyzing VLAN Tagged Traffic
In wireshark we can filter for "vlan" to inspect packets tagged with 802.1Q.  
<img width="2880" height="1800" alt="Pasted image 20250827171514" src="https://github.com/user-attachments/assets/049cf21f-0aac-4187-b7ee-e81d7f5c9137" />  
Using the filter `vlan.id == 10` we can search for packets tagged with VLAN 10.  
<img width="2880" height="1800" alt="Pasted image 20250827171604" src="https://github.com/user-attachments/assets/ac00d99c-81f3-40d6-91f6-e257f1dee7a9" />  
Additionally, to enumerate the used `VLAN` IDs from a packet dump, we can utilize [tshark](https://www.wireshark.org/docs/man-pages/tshark.html):
```shell-session
AnasSalhen@htb[/htb]$ tshark -r "The Ultimate PCAP v20221220.pcapng" -T fields -e vlan.id | sort -n -u

1
2
3
7
10
20
30
40
50
60
70
80
90
121
125
224
```

## Security Implications and VLAN Attacks
### VLAN Hopping
Dynamic Trunking Protocol (DTP) is a Cisco proprietary protocol that allows switches to communicate with each other and decide which ports should work as access ports and which ones as trunk ports. 

The problem is that an adversary can try to mimic a switch and send DTP frames to other switches to establish a trunk link between the attacker and the switch. When that happens the attacker receives traffic from all VLANs on that trunk link This attack can be performed using [Yersinia](https://linux.die.net/man/8/yersinia).

### Double-tagging VLAN Hopping
Although double-tagging is a legitimate networking practice used by companies such as ISPs, this feature can be abused by attackers. Steps for the attack:
1. The attacker sends a double-tagged 802.1Q Ethernet frame to the switch with the outer header having the VLAN ID of the attacker, which is the same as the native VLAN of the trunk port. Assume that the native VLAN is VLAN 10 and that VLAN 30 is the VLAN the adversary wants to reach, where the victim resides.
2. The outer 4-byte 802.1Q tag arrives on the switch, and it is seen to be destined for VLAN 10, the native VLAN. After removing the VLAN 10 tag, the frame is forwarded on all VLAN 10 ports. On the trunk port, the VLAN 10 tag is stripped (removed), and the packet is not re-tagged because it is part of the native VLAN. However, the VLAN 30 tag is still intact (not stripped), and the first switch has not inspected it.
3. Subsequently, the second switch will look only at the inner 802.1Q tag that the adversary sent, and it decides that the frame must be forwarded for VLAN 30, which is the adversary's chosen VLAN. Now, the second switch will either send the frame to the victim port directly or flood it, depending on whether there is an existing MAC address table entry for the victim host.

[Scapy](https://scapy.readthedocs.io/en/latest/usage.html#vlan-hopping) and Yersinia are tools that can perform this attack.

## VXLAN
Traditional VLANs are limited to 4094 IDs, which isn’t enough for large data centers or cloud providers that need millions of isolated networks. On top of that, Layer 2 networks rely on Spanning Tree Protocol (STP) to prevent loops, but STP blocks redundant links, wasting bandwidth and limiting resiliency. This makes scaling and efficient resource usage in virtualized environments very difficult.

VXLAN solves these issues by creating a **Layer 2 overlay on top of a Layer 3 network**. Instead of being limited to 4094 VLANs, VXLAN uses a 24-bit identifier (VNI), supporting up to 16 million segments = 16 million broadcast domains. It also allows Layer 2 networks to extend across data centers while taking advantage of Layer 3 routing, enabling better scalability, isolation, and efficient use of all available paths.

## CDP
Cisco Discovery Protocol (CDP) is a layer-2 network protocol that is used to gather info about directly connected Cisco devices.
